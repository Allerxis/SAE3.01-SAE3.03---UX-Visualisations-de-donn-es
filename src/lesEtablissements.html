<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- feuille de style -->
  <link rel="stylesheet" href="./css/style-tailwind.css">
  <script src="https://cdn.tailwindcss.com/"></script>
  <!-- fichiers js -->
  <script src="./js/bgMenu.js"></script>
  <script src="./js/navBarre.js"></script>

  <!-- Swiper JS -->
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script src="./js/filtresRecherche.js"></script>

  <title>Établissements</title>

</head>


<header>
  <div id="header-container"></div>
</header>

<body class="mt[8rem]">
  <main class="p-6 sm:mx-8 lg:my-10">
    <div class="text-center">
      <h1 class="font-bold text-5xl sm:my-10 sm:py-5 lg:text-7xl lg:py-6">Les différentes Académies</h1>
    </div>

    <div id="academies-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:mx-8 lg:mx-10 mb-8">
      <!-- Les académies seront insérées ici -->
    </div>

    <div id="etablissements-container"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:mx-8 lg:mx-10 mb-8 hidden">
      <!-- Les établissements filtrés seront insérés ici -->
    </div>
  </main>

  <script>
    // Charger et insérer le contenu de header.html
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-container').innerHTML = data;

        // Réexécuter le script bgMenu.js après l'injection
        const burgerBtn = document.getElementById('burger-btn');
        const menu = document.getElementById('menu');

        if (burgerBtn) {
          burgerBtn.addEventListener('click', () => {
            menu.classList.toggle('hidden');
          });
        }
      })
      .catch(error => console.error('Error loading header:', error));

    fetch('footer.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('footer-container').innerHTML = data;
      })
      .catch(error => console.error('Error loading header:', error));


    const apiAcademiesURL = 'https://la-lab4ce.univ-lemans.fr/masters-stats/api/rest/academies';
    const apiEtablissementsURL = 'https://la-lab4ce.univ-lemans.fr/masters-stats/api/rest/etablissements';

    const academiesContainer = document.getElementById('academies-container');
    const etablissementsContainer = document.getElementById('etablissements-container');

    let allEtablissements = [];

    // Fonction pour créer une carte d'académie
    const createAcademieCard = (academie) => {
      const card = document.createElement('div');
      card.className = 'p-4 bg-white border rounded-md shadow-sm cursor-pointer';
      card.innerHTML = `
            <h2 class="font-bold text-lg mb-2 lg:text-2xl">${academie.nom}</h2>
            <p class="text-sm text-gray-500">ID : ${academie.id}</p>
        `;
      card.addEventListener('click', () => {
        academiesContainer.classList.add('hidden'); // Cacher les académies
        etablissementsContainer.classList.remove('hidden'); // Afficher les établissements
        loadEtablissements(academie.id); // Charger les établissements de l'académie
      });
      return card;
    };

    // Fonction pour créer une carte d'établissement
    const createEtablissementCard = (etablissement) => {
      const card = document.createElement('a');
      card.href = `etablissement.html?id=${etablissement.uai}`;
      card.className = 'p-4 bg-white border rounded-md shadow-sm';
      card.innerHTML = `
            <h2 class="font-bold text-lg mb-2 lg:text-2xl">${etablissement.nom}</h2>
            <p class="text-sm text-gray-500">UAI : ${etablissement.uai}</p>
        `;
      return card;
    };

    // Charger les académies depuis l'API
    fetch(apiAcademiesURL)
      .then(response => response.json())
      .then(data => {
        data.forEach(academie => {
          const card = createAcademieCard(academie);
          academiesContainer.appendChild(card);
        });
      })
      .catch(error => console.error('Erreur chargement académies:', error));

    // Charger les établissements filtrés par académie
    const loadEtablissements = (academieId) => {
      etablissementsContainer.innerHTML = ''; // Efface les anciens établissements
      if (allEtablissements.length === 0) {
        fetch(apiEtablissementsURL)
          .then(response => response.json())
          .then(data => {
            allEtablissements = data;
            displayEtablissementsByAcademie(academieId);
          })
          .catch(error => console.error('Erreur chargement établissements:', error));
      } else {
        displayEtablissementsByAcademie(academieId);
      }
    };

    const displayEtablissementsByAcademie = (academieId) => {
      const filteredEtablissements = allEtablissements.filter(etab => etab.academieId === academieId);
      filteredEtablissements.forEach(etablissement => {
        const card = createEtablissementCard(etablissement);
        etablissementsContainer.appendChild(card);
      });
    };

  </script>
  <footer>
    <div id="footer-container"></div>
  </footer>
</body>


</html>